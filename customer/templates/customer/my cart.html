{% extends 'customer/master_customer.html' %}
{% load static %}

{% block title %}
<title>Your Cart</title>
<link rel="stylesheet" href="{% static 'style/cart_style.css' %}">

{% endblock %}

{% block content %}
<div class="cart_heading_div">

    <h2>Cart</h2>
    <p>

        <a href="#">Home</a> |
        <a href="#">Cart</a>

    </p>

</div>

<div class="container" style="margin-bottom: 50px;">
    <div>
        <table class="table" style="border: 1px;">
            <thead>
                <th>
                    Product Image
                </th>
                <th>
                    Product Name
                </th>
                <th>
                    Product Category
                </th>
                <th>
                    Product Price
                </th>
                <th>
                    Quantity
                </th>
                <th>
                    Total Price
                </th>
            </thead>
            <!-- {{cart_items}} -->
            {% for item in cart_items %}
            <tr>
                <td>
                    <img src="{{ item.product.p_image.url }}" width="75px">
                </td>
                <td>
                    {{ item.product.p_name |title}}
                </td>
                <td>
                    {{ item.product.p_category }}
                </td>
                <td>
                    ₹ {{ item.product.p_price }}
                </td>
                <td>
                    {% csrf_token %}
                    <input type="number" id="qty" min="1" data-item="{{ item.product.id }}"><br>
                    <span id="stock_error"></span>
                    <span id="stock_success"></span>
                </td>
                <td>
                    ₹ {{item.product.p_price}}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <label for="">Total Amount</label>
    <input type="text" name="" id=""><br><br>
    <button class="btn btn-warning">Place Order</button>
</div>

<script>

    // function getTotal(price) {
    //     let qty = document.getElementById('qty').value
    //     let total = parseFloat(price) * parseFloat(qty)
    //     console.log(total)
    // }

    $(document).ready(function () {
        $.ajaxSetup({
            headers: {
                "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
            }
        })

        $('#qty').change(function () {

            $.ajax({

                type: 'POST',
                url: "{% url 'customer:change_quantity' %}",
                data: {
                    'product_id': $(this).attr('data-item'),
                    'quantity': $(this).val()
                },


                success: function (response) {
                    let error = response.error_msg
                    // let success = response.success_msg
                    if (error == "In stock") {
                        $('#stock_error').html(error)
                        $('#stock_error').css('color', 'green')

                    } else {
                        $('#stock_error').html(error)
                        $('#stock_error').css('color', 'red')
                    }
                    $('#stock_error').html(error)
                    // $('#stock_success').html(success)


                }
            })
        })
    })

</script>
{% endblock %}



<!-- onchange="getTotal('{{item.product.p_price}}')"
                        max="{{item.product.p_stock}}" -->